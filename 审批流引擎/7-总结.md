#### 事务

前期事务逻辑在模型中导致有可能事务嵌套事务

优化: 事务是应用层调度的问题，应该前置到应用层或者放到服务层

#### 冗余

审批单和申请单关联的基础数据一致，表结构字段冗余不够好，导致后续的查询需要相互依赖

优化:字段冗余要恰到好处，前期没考虑到后续需要补充



#### 存在的问题及优化

1  长链路，无法有效的单元测试，测试成本比较高

2 事件的抽象粒度不够，导致后续的很多需求更变无法实现

3 运行流程基本已经优化，细节可以继续处理，使得运行流程可以阶段式处理

4 延迟的配置校验导致无法在未结束状态预览整个审批流程 

5 事件发布导致的惊群和逻辑分散

6 底层的异常无法有效的冒泡到应用层，导致交互方案不够优雅

7 埋点不统一，需要依赖底层模型的整体优化

8 内存过滤策略取代数据库

9 初始化配置独立，适配多端的不同需求





**经验及教训**

1. 项目未形成有效节点，从初期商机模块(原计划15工作日)扩展到四大主要模块，列表新旧数据兼容，数据兼容导致需要数据迁移，旧版逻辑移除和修改，再到适配移动端，版本无法同步
2. 对整体的工作内容没有充分评估，导致工时预估和人员安排不合理。原计划15天的，采用敏捷开发模式，与实际的项目体量不匹配。
3. 错误的指引和适用，项目初期复用工作流的逻辑。包括配置，触发逻辑。在实际开发中才发现完全不是同一个东西。导致已经使用的只能不断地硬适配，核心逻辑有缺陷，导致后面测试修复浪费很多时间。
4. 开发工作安排不合理。核心的审批逻辑，触发中断逻辑，适配逻辑，过滤逻辑，唤醒逻辑，应用逻辑以及配置接口，应用层接口，权限，字段设置，数据迁移，旧版逻辑移除与优化。除了配置接口，应用层接口，数据迁移之外，其他工作都与审批流的核心流程相关联难以分割，导致工作没有很好的安排
5. 审批流层涉及的业务比较复杂，相较其他业务，审批流是一个贯穿逻辑，导致开发，测试，验收的链路比较长，测试难以简单快速进行，上线和灰度之后的bug也需要反复测试，才能复现
6. 为了做到视图统一，花了大量的时间来做多端历史兼容和适配，以及历史配置和数据迁移